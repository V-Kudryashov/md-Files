Вы абсолютно правы относительно потенциальной путаницы в обозначениях, и я благодарю Вас за уточнение. В источнике действительно возникает коллизия, когда один и тот же символ $\hat{f}_i$ используется для обозначения двух разных пространственных сил в последовательных шагах алгоритма. Астериск (звездочка), который Вы упомянули, помогает разрешить эту неоднозначность, хотя в основных уравнениях алгоритма в Разделе 4.4 он явно не используется.

Ниже представлен алгоритм Рекурсивного Метода Ньютона-Эйлера (Recursive Newton-Euler Method, RNE) в его формулировке для абсолютных координат, изложенный в Главе 4, Раздел 4.4, с акцентом на рекуррентные соотношения и их вывод. RNE является наиболее эффективным известным методом для решения задачи обратной динамики, требующим $O(n)$ операций.

**Задача:** Найти скалярные силы в шарнирах ($Q_i$), необходимые для обеспечения заданных пространственных скоростей ($\dot{q}_i$) и ускорений ($\ddot{q}_i$).

### Шаг 1: Расчет движения звеньев (Link Motion)

На этом этапе вычисляются абсолютные пространственные скорости ($\hat{v}_i$) и ускорения ($\hat{a}_i$) для каждого звена, двигаясь от неподвижного основания (звено 0) к концевому захвату (звено $n$).

**1.1. Рекуррентное соотношение для скорости (Forward iteration)**

Скорость звена $i$ определяется суммой скорости его предшественника $\hat{v}_{i-1}$ и относительной пространственной скорости в шарнире $i$, которая равна произведению вектора оси шарнира $\hat{s}_i$ на скалярную шарнирную скорость $\dot{q}_i$:

$$\hat{v}_i = \hat{v}_{i-1} + \hat{s}_i \dot{q}_i \quad \text{(4.5)}$$

Начальное условие: Основание (звено 0) считается неподвижным, следовательно, $\hat{v}_0 = 0$.

**1.2. Рекуррентное соотношение для ускорения (Forward iteration)**

Ускорение $\hat{a}_i$ получается путем дифференцирования уравнения скорости (4.5) по времени. Полное ускорение включает три члена: ускорение предшествующего звена ($\hat{a}_{i-1}$), заданное шарнирное ускорение ($\hat{s}_i \ddot{q}_i$) и член, учитывающий центробежные и кориолисовы эффекты (Кориолиса/центробежных) за счет относительного движения ($\hat{v}_i \times \hat{s}_i \dot{q}_i$):

$$\hat{a}_i = \hat{a}_{i-1} + \hat{v}_i \times \hat{s}_i \dot{q}_i + \hat{s}_i \ddot{q}_i \quad \text{(4.6)}$$

Начальное условие: Ускорение основания $\hat{a}_0 = 0$ (если гравитация игнорируется). (Для учета гравитации задается фиктивное начальное ускорение $\hat{a}_0 = -\mathbf{g}$).

### Шаг 2: Расчет суммарной пространственной силы, действующей на звено

После определения движения вычисляется **суммарная пространственная сила** (net force) $\hat{f}_i$, которая требуется для сообщения звену $i$ рассчитанного движения. Эта сила равна скорости изменения пространственного импульса звена $\hat{I}_i \hat{v}_i$:

$$\hat{f}_i = \frac{d}{dt} (\hat{I}_i \hat{v}_i)$$

Разворачивая производную, получаем:

$$\hat{f}_i = \hat{I}_i \hat{a}_i + \hat{v}_i \times \hat{I}_i \hat{v}_i \quad \text{(4.7)}$$

В этой формуле:

*   $\hat{I}_i \hat{a}_i$ представляет инерционные силы и моменты.
*   $\hat{v}_i \times \hat{I}_i \hat{v}_i$ представляет центробежные и кориолисовы силы и моменты (скоростные члены).

*(Примечание относительно обозначений: В контексте Раздела 4.4 $\hat{f}_i$ (в Ур. 4.7) обозначает именно эту суммарную (чистую) силу, необходимую для движения звена. Когда в источнике (Ур. 4.8) эта сила используется в следующем рекуррентном соотношении, возникает двусмысленность. В более поздних уточнениях, когда учитываются внешние силы, чистая сила, рассчитанная на этом этапе, обозначается $\hat{f}_i^*$ (как $\hat{f}_i^*$ в уравнении $\hat{f}_i = \hat{f}_{i+1} + \hat{f}_i^* - \hat{f}_i^X$), чтобы отличить ее от передаваемой силы $\hat{f}_i$.)*

### Шаг 3: Расчет сил в шарнирах

На этом этапе алгоритм выполняется в обратном направлении, начиная от концевого захвата (звено $n$) и двигаясь к основанию (звено 1).

**3.1. Рекуррентное соотношение для передаваемой силы (Backward iteration)**

Вычисляется **полная сила, передаваемая** от звена $i-1$ к звену $i$ через шарнир $i$. Эта сила $\hat{f}_i$ (здесь $\hat{f}_i$ обозначает *передаваемую силу*) должна уравновешивать:
1.  Суммарную силу, необходимую для движения звена $i$ ($\hat{f}_i$ из Ур. 4.7).
2.  Сумму сил, передаваемых всем последующим звеньям ($\hat{f}_{i+1}$).

$$\hat{f}_i = \hat{f}_{i+1} + \hat{f}_i \quad \text{(4.8)}$$

Начальное условие: На концевом захвате (звено $n$) $\hat{f}_{n+1}$ — это любая внешняя сила, действующая на него (или $\hat{f}_{n+1} = \mathbf{0}$, если внешние силы отсутствуют).

**3.2. Расчет скалярной силы в шарнире**

Требуемая скалярная сила (или момент) в шарнире $Q_i$ находится путем проецирования вектора полной передаваемой силы $\hat{f}_i$ на ось шарнира $\hat{s}_i$ с использованием пространственного скалярного произведения:

$$Q_i = \hat{s}_i^S \hat{f}_i \quad \text{(4.9)}$$

Таким образом, рекурсивное использование этих трех шагов позволяет вычислить все требуемые шарнирные силы $Q_i$.
