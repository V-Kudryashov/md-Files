***
В главах

8. Branched Kinematic Chains, Multiple-Degree-of-Freedom Joints and Moving Bases и

9. Contact, Impact, Kinematic Loops and Friction используется алгоритм инверсной динамики.

Какой из двух?
***
В главах 8 и 9, когда речь заходит об инверсной (обратной) динамике в контексте обобщенных структур (таких как плавающее основание, разветвленные цепи или наличие контактов), задача трансформируется из «чистой» обратной динамики в **гибридную задачу прямой и обратной динамики (Hybrid Forward/Inverse Dynamics)**.

Источники указывают, что для решения таких задач используются гибридные версии двух основных алгоритмов:

1.  **Гибридный алгоритм на основе алгоритма сочлененного тела (Articulated-Body Algorithm, ABA):**
    *   Этот алгоритм описывается как наиболее подходящий для систем с плавающим основанием и внешними силами, так как сочлененные тела по своей природе являются «плавающими».
    *   Он позволяет для каждого отдельного шарнира вычислять либо силу по заданному ускорению, либо ускорение по заданной силе.
    *   Именно этот вариант упоминается как «общий гибридный алгоритм» в главе 8.

2.  **Гибридный алгоритм на основе метода композитного твердого тела (Composite-Rigid-Body Method, CRBM):**
    *   Этот подход используется для решения задач инверсной динамики робота с плавающим основанием.
    *   Алгоритм сначала вычисляет инерцию композитного твердого тела всей системы, чтобы найти ускорение основания, а затем через рекурсивные соотношения находит силы в шарнирах.
    *   В главе 9 этот метод (основанный на CRBA) используется для моделирования **ограничителей движения суставов (joint end stops)** и сил трения

***
В какой главе описаны гибридные алгоритмы ABA и CRBA?
***
Да, предоставленные источники содержат подробное описание и вывод алгоритма обратной динамики. Основным источником в этом вопросе является диссертация **Роя Фезерстоуна**, где целая глава (Глава 4) посвящена **Рекурсивному методу Ньютона-Эйлера (Recursive Newton-Euler Method, RNE)**.

Ниже приведено описание алгоритма и его особенностей согласно источникам:

### 1. Цель алгоритма
Обратная динамика — это задача поиска **сил или моментов в шарнирах** ($Q_i$), необходимых для обеспечения заданных **ускорений в шарнирах** ($\ddot{q}_i$) при известных текущих положениях и скоростях.

### 2. Рекурсивный метод Ньютона-Эйлера (RNE)
Фезерстоун описывает RNE как наиболее эффективный алгоритм для роботов с открытой кинематической цепью, имеющий вычислительную сложность **$O(n)$**. Алгоритм состоит из трех основных этапов:

*   **Шаг 1: Расчет движения звеньев (Прямая рекурсия).** Итерируя от основания к конечному звену, вычисляются абсолютные пространственные скорости ($\hat{v}_i$) и ускорения ($\hat{a}_i$) каждого звена.
    *   Гравитация учитывается путем задания основанию фиктивного ускорения $\hat{a}_0 = -\mathbf{g}$.
*   **Шаг 2: Расчет чистых сил (Net Forces).** Для каждого звена вычисляется суммарная пространственная сила $\hat{f}_i$, требуемая для его движения, исходя из его инерции ($\hat{I}_i$) и рассчитанного ускорения.
*   **Шаг 3: Расчет сил в шарнирах (Обратная рекурсия).** Итерируя от конца к основанию, вычисляются полные силы, передаваемые через шарниры. Искомые скалярные силы шарниров ($Q_i$) получаются путем проецирования этих сил на оси шарниров ($\hat{s}_i$):
    $$Q_i = \hat{s}_i^S \hat{f}_i$$

### 3. Гибридная обратная/прямая динамика (Floating Base)
Более современные источники (Lee & Goswami, Macchietto) расширяют эту тему для **гуманоидных роботов с «плавающим» основанием**.

*   Для таких систем задача становится **гибридной**: ускорение основания изначально неизвестно и должно быть вычислено (прямая динамика), в то время как для остальных шарниров заданы ускорения и нужно найти силы (обратная динамика).
*   Для решения используются алгоритмы динамики гибридных систем, которые позволяют эффективно ($O(n)$) вычислять крутящие моменты шарниров в реальном времени.
*   В этих работах обратная динамика является финальным шагом управления: после определения допустимых ускорений ($\ddot{q}$) и внешних сил ($f_c$), алгоритм вычисляет управляющие моменты ($\tau_s$).

### 4. Реализация в координатах звеньев
Фезерстоун подчеркивает, что для максимальной вычислительной мощности алгоритм следует реализовывать в **собственных координатах звеньев**. Это исключает необходимость трансформации тензоров инерции, требуя лишь трансформации векторов скоростей, ускорений и сил между соседними звеньями.

**Аналогия:** Представьте, что вы тянете за собой цепочку людей. Чтобы понять, с какой силой должен тянуть каждый человек в цепи, вам сначала нужно знать, как быстро движется каждый из них (прямой проход), а затем, начиная с последнего человека, передавать информацию о «натяжении» обратно к первому (обратный проход).

**Резюме:**
Хотя для простых разветвленных цепей без плавающего основания все еще может применяться модифицированный **рекурсивный метод Ньютона-Эйлера (RNE)**, для более сложных случаев (плавающее основание, петли, контакты) источники описывают переход к **гибридным алгоритмам**, реализованным на базе **ABA** и **CRBA**. При этом отмечается, что для роботов с плавающим основанием **ABA** становится гораздо эффективнее, чем **CRBA**.
