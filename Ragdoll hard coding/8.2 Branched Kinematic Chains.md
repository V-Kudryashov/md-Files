Ниже представлен перевод раздела **8.2 «Разветвленные кинематические цепи»** из Главы 8 диссертации Роя Фезерстоуна, выполненный на основе предоставленных фрагментов текста.

---

### 8.2 Разветвленные кинематические цепи

Под **разветвленной кинематической цепью** я подразумеваю систему, в которой звенья могут быть соединены любым способом, соответствующим топологическому **дереву**. В сущности, это означает отсутствие кинематических циклов (петель) и то, что ни одна часть робота не отсоединена полностью от остальной структуры. Рисунок 8.1 представляет собой пример такой системы. **Базовое звено** (которое по-прежнему считается неподвижным) выбирается в качестве корня дерева, а самые крайние звенья, имеющие только один шарнир, являются **«листьями»**. Соседнее звено я буду называть его *предшественником* (predecessor) или *преемником* (successor) в зависимости от того, находится ли оно ближе к базе или дальше от неё. Шарнир, соединяющий звено с его предшественником, называется его **внутренним шарниром**, а шарниры, соединяющие его с преемниками — **внешними шарнирами**. Каждое звено, за исключением базы, имеет ровно один внутренний шарнир, но может иметь любое количество внешних шарниров.

Главное отличие такой древовидной структуры от неразветвленных цепей, которые использовались до сих пор, заключается в том, что для дерева необходимо задавать **связность** (connectivity) явно, тогда как в неразветвленной цепи она была заложена в самой схеме нумерации. Связность определяется введением для каждого звена величины **$\lambda_i$**, которая является идентификационным номером предшествующего звена. Для древовидной структуры, показанной на рис. 8.1, значения $\lambda_i$ для $i=1..6$ составляют $(0, 1, 2, 1, 4, 4)$. Одной величины $\lambda_i$ достаточно для определения связности, но для удобства обозначений при описании итераций, идущих от базы к листьям, я ввожу для каждого звена дополнительную величину **$\mu_i$**, представляющую собой набор идентификационных номеров всех преемников звена $i$. Для структуры на рис. 8.1 значения $\mu_i$ будут следующими: $\mu_0 = \{1\}$, $\mu_1 = \{2, 4\}$, $\mu_2 = \{3\}$, $\mu_4 = \{5, 6\}$, а наборы $\mu_3, \mu_5, \mu_6$ являются пустыми. «Листья» отличаются тем, что имеют пустые наборы $\mu$.

Систематическая нумерация звеньев больше не является обязательной, но она всё ещё удобна и будет сохранена. Я буду использовать следующую схему нумерации: базовое звено обозначается цифрой **0**, а остальные звенья нумеруются от **1 до $n$** так, чтобы каждое звено имело более высокий идентификационный номер, чем номер его предшественника. Внутренний шарнир для звена $i$ называется **шарниром $i$** (нумерация на рис. 8.1 следует этой схеме). Эта схема нумерации вырождается в нашу исходную систему нумерации применительно к неразветвленной цепи, но для разветвленной цепи уникальной нумерации обычно не существует. Матрица преобразования координат между соседними звеньями через шарнир $i$ теперь записывается как **${^i}\hat{X}_{\lambda_i}$**.

#### 8.2.1 Модификация алгоритмов

Уравнения алгоритмов Ньютона-Эйлера и сочлененного тела можно разделить на три группы: те, которые итерируются **от базы к конечному звену**; те, что итерируются **от конечного звена к базе**; и те, что выполняют вычисления **локально** для каждого звена. Члены последней группы не зависят от связности и не требуют модификации.

Уравнения **прямой итерации** (наружу) передают величины типа «движение» от базы к конечному звену. Примером является расчет скорости звена (уравнение 4.5):
$$\hat{v}_i = \hat{v}_{i-1} + \hat{s}_i \dot{q}_i; \quad (\hat{v}_0 = 0) \quad (1)$$
В этом контексте выражение $i-1$ на самом деле означает **«предшественник звена $i$»**, поэтому модификация этих уравнений для работы с разветвленными цепями заключается просто в замене индекса $i-1$ на **$\lambda_i$**. Расчет скорости звена для древовидной структуры принимает вид:
$$\hat{v}_i = \hat{v}_{\lambda_i} + \hat{s}_i \dot{q}_i; \quad (\hat{v}_0 = 0) \quad (2)$$
Если придерживаться исходного порядка вычислений (от $i=1$ до $n$), то $\hat{v}_{\lambda_i}$ всегда будет вычислена раньше, чем $\hat{v}_i$ (так как $\lambda_i < i$).

Уравнения **обратной итерации** (внутрь) передают силы или инерции от конечного звена к базе. В древовидной структуре любое звено получает одну такую величину от каждого из своих преемников, и поскольку эти величины аддитивны, итоговое значение является суммой всех вкладов. Например, расчет полных сил в шарнирах для метода Ньютона-Эйлера (ур. 4.8) выглядит так:
$$\hat{f}_i = \hat{f}_{i+1} + \hat{f}_i^*; \quad (\hat{f}_{n+1} = \hat{f}_{ext}) \quad (3)$$
Это уравнение гласит, что полная сила, необходимая для поддержания движения всех звеньев, начиная с $i$-го и далее, равна сумме силы для обеспечения движения самого звена $i$ и сил для всех последующих звеньев. В контексте дерева звено $i$ напрямую поддерживает все звенья $j$, где $j \in \mu_i$, поэтому член $\hat{f}_{i+1}$ в уравнении (3) должен быть заменен на **$\sum_{j \in \mu_i} \hat{f}_j$**:
$$\hat{f}_i = \sum_{j \in \mu_i} \hat{f}_j + \hat{f}_i^* \quad (4)$$
Обратите внимание, что теперь нет необходимости в отдельном начальном условии, так как расчет $\hat{f}_i$ в случае, когда звено $i$ является «листом», обрабатывается корректно благодаря тому, что $\mu_i$ для такого звена является пустым множеством. Опять же, если вести расчет от $n$ до 1, мы всегда вычислим все $\hat{f}_j$ раньше, чем $\hat{f}_i$.

Более сложным примером является расчет **инерций сочлененного тела**. Для неразветвленной цепи это описывается уравнением (6.37):
$$\hat{I}_i^A = \hat{I}_i + \hat{I}_{i+1}^A - \frac{\hat{I}_{i+1}^A \hat{s}_{i+1} \hat{s}_{i+1}^S \hat{I}_{i+1}^A}{\hat{s}_{i+1}^S \hat{I}_{i+1}^A \hat{s}_{i+1}}; \quad (\hat{I}_n^A = \hat{I}_n) \quad (5)$$
Величина, которая передается обратно от звена-преемника, представлена в виде выражения, а не одиночной величины, поэтому версия этого уравнения для разветвленной цепи будет иметь вид:
$$\hat{I}_i^A = \hat{I}_i + \sum_{j \in \mu_i} \left( \hat{I}_j^A - \frac{\hat{I}_j^A \hat{s}_j \hat{s}_j^S \hat{I}_j^A}{\hat{s}_j^S \hat{I}_j^A \hat{s}_j} \right) \quad (6)$$

Расчет **матрицы инерции в пространстве шарниров** (joint-space inertia matrix) не вписывается в вышеописанную схему, но также легко модифицируется. Матрица инерции в пространстве шарниров определяется уравнением (5.8) как:
$$H_{ji} = \hat{s}_j^S \hat{f}_i; \quad (j \le i) \quad (7)$$
где $\hat{f}_i$ — это сила, необходимая для сообщения единичного ускорения композитному твердому телу, состоящему из звеньев $i..n$, а $H_{ji}$ — это сила в шарнире $j$, необходимая для поддержки $\hat{f}_i$ в шарнире $i$. В случае древовидной структуры это уравнение применимо только в том случае, если шарнир $j$ **поддерживает поддерево**, содержащее движущиеся звенья. Например, согласно рис. 8.1, если $i=5$, то уравнение (7) применимо только к шарнирам 1, 4 и 5, а значения $H_{25}$ и $H_{35}$ будут равны нулю, так как ни шарнир 2, ни шарнир 3 не поддерживают движение шарнира 5.

Чтобы выразить это кратко, я ввожу множества **$\nu_j$**, которые для каждого шарнира перечисляют все звенья в поддереве, поддерживаемом этим шарниром. $\nu_j$ определяется следующим образом: $k \in \nu_j$ тогда и только тогда, когда $k = j$ или ($k \in \mu_p$ и $p \in \nu_j$). С этим определением мы можем выразить версию уравнения (7) для древовидной структуры как:
$$H_{ji} = \hat{s}_j^S \hat{f}_i \quad \text{при } i \in \nu_j \text{ (иначе 0)} \quad (9)$$
Можно обойтись без использования $\nu_j$, если изначально установить все элементы $H$ в ноль и использовать уравнение (7), где $i$ меняется от $n$ до 1, а $j$ принимает значения $i, \lambda_i, \lambda_{\lambda_i}$ и так далее, для вычисления ненулевых элементов $H$.
