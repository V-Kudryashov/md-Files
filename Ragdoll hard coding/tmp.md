Articulated-Body Inertia (ABI): построчное объяснение

Рассматривается древовидная система тел с плавающим основанием. Корень не актуирован. Все величины — пространственные (6D).

### Обозначения

$q_b$
Для каждого звена 
$𝑖$

$I_i$ — пространственная инерция

$v_i$ — пространственная скорость

$I_i$ — пространственное ускорение

$I_i$ — пространственная сила

$I_i$ — bias force (Coriolis + centrifugal + gravity)

$X_iλ(i)$ — spatial transform от родителя 

Для каждого сустава $i:$

$S_i$ — motion subspace (6×1 для 1-DOF)

$\dot q_i$
,
$\ddot q_i$ — скорость и ускорение сустава

$𝜏_i$ — суставной момент

### Шаг 1. Forward recursion (скорости и bias)

Для плавающего основания (root):

𝑣
0
 задано
,
𝑎
0
=
𝑞
¨
𝑏
v
0
	​

 задано,a
0
	​

=
q
¨
	​

b
	​


Для каждого звена 
𝑖
i, от корня к листьям:

Скорость
𝑣
𝑖
=
𝑋
𝑖
𝜆
(
𝑖
)
𝑣
𝜆
(
𝑖
)
+
𝑆
𝑖
𝑞
˙
𝑖
v
i
	​

=X
iλ(i)
	​

v
λ(i)
	​

+S
i
	​

q
˙
	​

i
	​

Кориолисов член
𝑐
𝑖
=
𝑣
𝑖
×
(
𝑆
𝑖
𝑞
˙
𝑖
)
c
i
	​

=v
i
	​

×(S
i
	​

q
˙
	​

i
	​

)
Bias force
𝑝
𝑖
=
𝑣
𝑖
×
∗
(
𝐼
𝑖
𝑣
𝑖
)
−
𝐼
𝑖
𝑔
p
i
	​

=v
i
	​

×
∗
(I
i
	​

v
i
	​

)−I
i
	​

g

Здесь:

×
× — spatial cross product (motion)

×
∗
×
∗
 — dual cross product (force)

𝑔
g — пространственная гравитация

Шаг 2. Upward recursion (articulated-body inertia)

Инициализация:

𝐼
𝑖
𝐴
=
𝐼
𝑖
,
𝑝
𝑖
𝐴
=
𝑝
𝑖
I
i
A
	​

=I
i
	​

,p
i
A
	​

=p
i
	​


Обход от листьев к корню.

Проекция инерции на подпространство сустава
𝑈
𝑖
=
𝐼
𝑖
𝐴
𝑆
𝑖
U
i
	​

=I
i
A
	​

S
i
	​

Суставная инерция
𝑑
𝑖
=
𝑆
𝑖
𝑇
𝑈
𝑖
d
i
	​

=S
i
T
	​

U
i
	​

Ключевой шаг ABI (устранение актуируемого DOF)
𝐼
𝑖
𝐴
←
𝐼
𝑖
𝐴
−
𝑈
𝑖
𝑈
𝑖
𝑇
𝑑
𝑖
I
i
A
	​

←I
i
A
	​

−
d
i
	​

U
i
	​

U
i
T
	​

	​


Это главное отличие ABI от RNEA:
инерция становится согласованной с суставным ограничением.

Обновление bias force
𝑝
𝑖
𝐴
←
𝑝
𝑖
𝐴
+
𝐼
𝑖
𝐴
𝑐
𝑖
p
i
A
	​

←p
i
A
	​

+I
i
A
	​

c
i
	​

Передача родителю
𝐼
𝜆
(
𝑖
)
𝐴
+
=
𝑋
𝑖
𝜆
(
𝑖
)
𝑇
𝐼
𝑖
𝐴
𝑋
𝑖
𝜆
(
𝑖
)
I
λ(i)
A
	​

+=X
iλ(i)
T
	​

I
i
A
	​

X
iλ(i)
	​

𝑝
𝜆
(
𝑖
)
𝐴
+
=
𝑋
𝑖
𝜆
(
𝑖
)
𝑇
𝑝
𝑖
𝐴
p
λ(i)
A
	​

+=X
iλ(i)
T
	​

p
i
A
	​

Шаг 3. Решение для floating base

После завершения upward recursion в корне:

𝑓
0
=
𝐼
0
𝐴
𝑎
0
+
𝑝
0
𝐴
f
0
	​

=I
0
A
	​

a
0
	​

+p
0
A
	​


Важно:

𝑓
0
f
0
	​

 — реакция среды / контактов

это не управляющая сила

корень остаётся неактуированным

Шаг 4. Downward recursion (ускорения и торки)

Для корня:

𝑎
0
=
𝑞
¨
𝑏
a
0
	​

=
q
¨
	​

b
	​


Для каждого звена 
𝑖
i, от корня к листьям:

Ускорение сустава
𝑞
¨
𝑖
=
𝜏
𝑖
−
𝑆
𝑖
𝑇
(
𝐼
𝑖
𝑎
𝜆
(
𝑖
)
+
𝑝
𝑖
)
𝑑
𝑖
q
¨
	​

i
	​

=
d
i
	​

τ
i
	​

−S
i
T
	​

(I
i
	​

a
λ(i)
	​

+p
i
	​

)
	​


(в статье Momentum-Based Control вместо 
𝜏
𝑖
τ
i
	​

 часто подставляется заданное 
𝑞
¨
𝑖
𝑑
𝑒
𝑠
q
¨
	​

i
des
	​

)

Ускорение звена
𝑎
𝑖
=
𝑋
𝑖
𝜆
(
𝑖
)
𝑎
𝜆
(
𝑖
)
+
𝑆
𝑖
𝑞
¨
𝑖
+
𝑐
𝑖
a
i
	​

=X
iλ(i)
	​

a
λ(i)
	​

+S
i
	​

q
¨
	​

i
	​

+c
i
	​

Суставной момент (final)
𝜏
𝑖
=
𝑆
𝑖
𝑇
(
𝐼
𝑖
𝑎
𝑖
+
𝑝
𝑖
)
τ
i
	​

=S
i
T
	​

(I
i
	​

a
i
	​

+p
i
	​

)

Это constraint-consistent torque для ragdoll.

Что принципиально важно

Floating base никогда не получает torque

Реакции опоры появляются автоматически через 
𝑓
0
f
0
	​


Алгоритм корректен для humanoid и ragdoll

ABI — обязательный шаг между оптимизацией ускорений и физическим управлением

Источник

Roy Featherstone
Robot Dynamics Algorithms, 1987

Официальная страница автора:
https://royfeatherstone.org/robot-dynamics-algorithms.html
